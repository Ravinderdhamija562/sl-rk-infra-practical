# Production values for NGINX Ingress Controller
# This file is intended for a production deployment using the official Kubernetes NGINX Ingress Controller chart.
# Adjust resource limits, replica counts, and AWS-specific annotations as needed for your environment.

controller:
  # Number of replicas for high availability
  replicaCount: 1

  # Service configuration - LoadBalancer type will create an AWS NLB
  service:
    type: LoadBalancer
    annotations:
      # AWS-specific annotations for Network Load Balancer
      service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
      service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: "true"
      service.beta.kubernetes.io/aws-load-balancer-backend-protocol: "tcp"
      # Optional: Use internal NLB instead of internet-facing
      # service.beta.kubernetes.io/aws-load-balancer-internal: "true"
    
    # Ports exposed by the LoadBalancer
    ports:
      http: 80
      https: 443
    
    targetPorts:
      http: http
      https: https

  # Resource requests and limits for production workloads
  resources:
    limits:
      cpu: "500m"
      memory: "512Mi"
    requests:
      cpu: "250m"
      memory: "256Mi"

  # Enable metrics for monitoring (Prometheus)
  metrics:
    enabled: false
    service:
      annotations:
        prometheus.io/scrape: "true"
        prometheus.io/port: "10254"

  # Pod disruption budget for high availability
  podDisruptionBudget:
    enabled: false
    minAvailable: 1

  # Autoscaling (optional, can be enabled for dynamic scaling)
  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 5
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80

  # Ingress class configuration
  ingressClassResource:
    name: nginx
    enabled: true
    default: true
    controllerValue: "k8s.io/ingress-nginx"

  # Additional configuration
  config:
    # Enable real IP forwarding (important for AWS NLB)
    use-forwarded-headers: "true"
    compute-full-forwarded-for: "true"
    use-proxy-protocol: "false"
    
    # SSL/TLS settings
    ssl-protocols: "TLSv1.2 TLSv1.3"
    ssl-ciphers: "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384"
    
    # Performance tuning
    worker-processes: "auto"
    max-worker-connections: "16384"

  # Node selector, tolerations, and affinity for production placement
  nodeSelector: {}
  
  tolerations: []
  
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                    - ingress-nginx
            topologyKey: kubernetes.io/hostname

# Default backend (optional - provides a default 404 page)
defaultBackend:
  enabled: true
  replicaCount: 1
  resources:
    limits:
      cpu: "50m"
      memory: "64Mi"
    requests:
      cpu: "25m"
      memory: "32Mi"

# RBAC configuration
rbac:
  create: true

# Service account configuration
serviceAccount:
  create: true
  name: ""

# Additional custom configuration can be added below as needed.
